generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/**
 * Usuários (vendedor responsável)
 */
model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // relacionamento: leads que o usuário é dono
  leads     Lead[]

  @@map("user")
}

/**
 * Estágios do funil
 */
enum Stage {
  LEAD
  MQL
  ANALISE_MQL
  SQL
  REUNIAO
}

/**
 * Leads do CRM
 */
model Lead {
  id         Int       @id @default(autoincrement())

  // Campos da tela
  name       String                              // Nome
  company    String?                             // Empresa
  email      String?                             // Email (não único)
  phone      String?    @db.VarChar(30)          // Telefone
  jobTitle   String?                             // Cargo
  origin     String?                             // Origem (Site, Anúncio, Indicação...)
  score      Int?       @db.SmallInt             // Score (0–100, por ex.)
  notes      String?    @db.Text                 // Observações

  // Oportunidade
  value      Decimal?   @db.Decimal(12, 2)       // Valor da oportunidade (R$)
  stage      Stage      @default(LEAD)

  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  // Dono / Vendedor Responsável (opcional)
  ownerId    Int?
  owner      User?      @relation(fields: [ownerId], references: [id], onDelete: SetNull)

  // Índices úteis pra filtros e buscas
  @@index([stage])
  @@index([ownerId])
  @@index([email])
  @@index([phone])
  @@map("lead")
}
